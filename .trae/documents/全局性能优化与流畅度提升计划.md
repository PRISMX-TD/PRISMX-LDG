## 优化目标
- 降低首屏加载体积与阻塞时间，提升页面响应与交互流畅度
- 加快数据读取与写入路径，减少冗余请求与重复计算
- 改善视觉性能（动画、布局稳定性、滚动与过渡），提升主观流畅度

## 客户端渲染优化
- 组件分层与懒加载：将图表、模态框、分析页等重型组件按路由与视口懒加载，仅在可见时加载
- 计算缓存：对金额格式化、交易聚合、图表数据转换等使用 memo 缓存，避免在每次渲染重复计算
- 列表渲染：对“交易记录列表”采用虚拟化（仅渲染可见行），并拆分为可复用的行组件以减少重渲染
- 图表渲染：限制数据点数量、显式高度、按需采样；移动端优先使用更轻量模式并延后渲染
- Radix 组件：按需使用并懒加载重型交互组件，能用原生/轻量控件的场景替换以减少 122k+ 的 UI 依赖开销

## React Query 与网络请求
- 统一 queryKey 设计：将所有列表与详情请求采用结构化键（包含路由与参数），避免失效与重复请求
- 合理缓存策略：为稳定数据设置较长 `staleTime` 与 `gcTime`，打开请求去重与后台刷新，减少前端重复拉取
- 预取与并行：进入仪表盘时并发拉取用户、钱包、近期交易与统计；路由切换前预取下页关键数据
- 失败重试与节流：为不关键的统计与汇率请求设置退避重试与节流，减少抖动与对后端压力

## 服务端与静态资源
- 压缩与传输：开启 gzip/brotli 压缩与强缓存；保留 HTML no-store，assets immutable（已配置），补充压缩中间件
- 条件缓存：为 GET API 返回 ETag/Last-Modified；客户端携带 If-None-Match/If-Modified-Since，降低重复载荷
- 500 错误治理：确保必需环境变量（如 DATABASE_URL）与依赖存在，避免服务崩溃导致静态资源 500
- HTTP 连接：在支持平台启用 HTTP/2/3 提升并发资源加载效率

## 数据库与查询路径
- 索引优化：为交易表添加组合索引（userId、date、type、walletId），为钱包/分类表按 userId 建索引
- 统计下推：将月度收入/支出统计在数据库侧计算，减少前端 O(n) 归并开销
- 分页模型：将 offset-limit 改为游标分页，降低大列表翻页成本并避免深翻页退化
- 写入安全：对跨币种转账与汇率写入做幂等与校验，减少失败重试造成的一致性问题

## PWA 与缓存策略
- 预缓存最小化：仅预缓存首屏关键资源，避免 SW 过度占用与更新阻塞
- 运行时缓存：对 GET API 采用 stale-while-revalidate；禁用对写入请求的缓存，支持离线排队（可选）
- 安装体验：修复 beforeinstallprompt 的调用流程，明确用户可安装引导与时机

## 视觉与交互流畅度
- 动画与过渡：统一采用 transform/opacity，减少 box-shadow 与 blur；控制动画时长与曲线一致性
- 布局稳定：为图表与卡片设置明确尺寸与占位，降低 CLS；避免加载态引起布局跳变
- 滚动性能：启用原生滚动与 `will-change` 在必要元素上，减少合成层切换

## 构建与包体
- 路由级代码拆分：确保各页面 chunk 独立，避免首屏拉取不相关页面逻辑
- 依赖瘦身：按需使用 Radix；评估图表库替代或轻量模式；清理未使用的辅助库
- CSS 体积：精简全局样式与主题变量，避免过度阴影与滤镜导致的重绘

## 监测与回归
- Web Vitals：采集 LCP、CLS、FID、TTFB、INP 指标并上报，定位真实瓶颈
- 性能基线：为仪表盘与交易列表建立渲染时间与请求耗时基线，作为后续优化验证标准

## 执行顺序（高收益优先）
1. 统一 React Query 键与缓存策略 + 并发预取
2. 列表虚拟化与图表懒加载（移动端显式高度与采样）
3. 压缩与 ETag/条件缓存 + 服务器 500 根因治理（环境变量）
4. 数据库索引与统计下推（减少前端归并）
5. Radix/重型依赖瘦身与动画策略统一
6. PWA 缓存策略与安装体验修复
7. Web Vitals 监测闭环，逐项验证收益